<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Virtual Lab Teknik â€“ Uji Konduktivitas Listrik</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- LIBRARY -->
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

<style>
/* =====================
   GLOBAL
===================== */
body {
  background:#f6f8fb;
  font-family: Segoe UI;
}

/* =====================
   HEADER
===================== */
.header-purple-pink {
  background: linear-gradient(135deg, #6f42c1, #d63384);
  padding: 15px 25px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.stage-card { gap:24px; }

.stage-badge,
.btn-stage {
  height:32px;
  font-size:.85rem;
  font-weight:600;
  display:flex;
  align-items:center;
  border-radius:6px;
}

.stage-badge {
  border:1px solid #dee2e6;
  color:#6f42c1;
}

.btn-stage {
  border:1px solid #dee2e6;
  background:#f8f9fa;
  color:#6f42c1;
}

/* =====================
   LAYOUT
===================== */
.main {
  display:flex;
  min-height: calc(100vh - 70px);
}

/* RAK */
.rack {
  width:300px;
  background:#fff;
  border-right:1px solid #eee;
  padding:20px;
  display:flex;
  flex-direction:column;
}

.tool {
  background:#f1f3f7;
  border-radius:8px;
  padding:10px;
  margin-bottom:10px;
  cursor:grab;
  display:flex;
  align-items:center;
  gap:10px;
}

/* WORKSPACE */
.workspace {
  flex:1;
  padding:20px;
  background:url('assets/img/bg-teknik.jpg') no-repeat center;
  background-size:cover;
}

/* CARD */
.card-box {
  background:#fff;
  border-radius:12px;
  padding:20px;
  box-shadow:0 10px 30px rgba(0,0,0,.08);
  margin-bottom:20px;
}

.table-area {
  height:280px;
  border:2px dashed #ccc;
  border-radius:12px;
  display:flex;
  justify-content:center;
  align-items:flex-end;
  position:relative;
}

/* =====================
   RANGKAIAN LISTRIK
===================== */
.board {
  width:220px;
  height:120px;
  border:3px solid #555;
  border-radius:10px;
  background:#f8f9fa;
  position:relative;
}

/* ARUS LISTRIK */
.wire {
  position:absolute;
  width:100%;
  height:4px;
  top:50%;
  left:0;
  opacity:0;
  background: repeating-linear-gradient(
    90deg,
    #ffc107 0px,
    #ffc107 10px,
    transparent 10px,
    transparent 20px
  );
}

.wire.active {
  opacity:1;
  animation: flow 1s linear infinite;
}

@keyframes flow {
  from { background-position:0 0; }
  to { background-position:40px 0; }
}

/* =====================
   BUTTON
===================== */
.btn-purple-pink {
  background: linear-gradient(135deg, #6f42c1, #d63384);
  color:#fff;
  border:none;
  font-weight:600;
}

.btn-purple-pink:hover {
  background: linear-gradient(135deg, #5a34a3, #b82a6a);
}
</style>
</head>

<body>

<!-- HEADER -->
<div class="header-purple-pink">
  <h5 class="text-white mb-0">
    <i class="fa fa-bolt"></i> Virtual Lab Teknik â€“ Uji Konduktivitas Listrik
  </h5>

  <div class="d-flex stage-card">
    <span class="badge badge-light stage-badge">
      Tahap <span id="stage">1</span>
    </span>
    <button class="btn btn-light btn-stage" onclick="startRecord()">
      <i class="fa fa-video mr-1"></i> Rekam
    </button>
  </div>
</div>

<div class="main">

<!-- RAK -->
<div class="rack">
  <h6>Rak Alat & Bahan</h6>

  <div class="tool" draggable="true" data-item="circuit">
    <i class="fas fa-project-diagram"></i> Rangkaian
  </div>

  <div class="tool" draggable="true" data-item="battery">
    <i class="fas fa-battery-full"></i> Baterai
  </div>

  <div class="tool" draggable="true" data-item="lamp">
    <i class="fas fa-lightbulb"></i> Lampu
  </div>

  <hr>

  <div class="tool" draggable="true" data-item="metal">
    <i class="fas fa-cog"></i> Logam
  </div>

  <div class="tool" draggable="true" data-item="plastic">
    <i class="fas fa-cube"></i> Plastik
  </div>

  <button class="btn btn-purple-pink btn-sm btn-block mt-auto" onclick="goBack()">
    <i class="fa fa-arrow-left"></i> Kembali
  </button>
</div>

<!-- WORKSPACE -->
<div class="workspace">

  <div class="card-box">
    <h6>Meja Eksperimen</h6>
    <div class="table-area" id="table"></div>
  </div>

  <div class="card-box">
    <b id="instruction">Tahap 1: Seret modul rangkaian ke area kerja</b>
  </div>

  <div class="card-box d-none" id="resultBox">
    <h6>Hasil Pengujian</h6>

    <table class="table table-sm table-bordered">
      <thead class="thead-light">
        <tr>
          <th>Material</th>
          <th>Sifat</th>
          <th>Hasil</th>
        </tr>
      </thead>
      <tbody id="resultTable"></tbody>
    </table>

    <button class="btn btn-purple-pink btn-sm" onclick="stopRecord()">
      <i class="fa fa-download"></i> Unduh Video
    </button>

    <button class="btn btn-purple-pink btn-sm" onclick="resetExperiment()">
      <i class="fa fa-refresh"></i> Ulangi
    </button>
  </div>

</div>
</div>

<script>
/* =====================
   STATE
===================== */
let state = {
  circuit:false,
  battery:false,
  lamp:false,
  tested:false
};

const table = document.getElementById('table');

/* DRAG */
document.querySelectorAll('.tool').forEach(t=>{
  t.addEventListener('dragstart',e=>{
    e.dataTransfer.setData('item',t.dataset.item);
  });
});

/* DROP */
table.addEventListener('dragover',e=>e.preventDefault());
table.addEventListener('drop',e=>{
  e.preventDefault();
  const item = e.dataTransfer.getData('item');

  if(item==="circuit" && !state.circuit){
    const board=document.createElement('div');
    board.className='board';
    board.id='board';

    const wire=document.createElement('div');
    wire.className='wire';
    wire.id='wire';

    board.appendChild(wire);
    table.appendChild(board);

    state.circuit=true;
    setStage(2);
    instruction("Tahap 2: Tambahkan baterai");
  }

  if(item==="battery" && state.circuit && !state.battery){
    state.battery=true;
    setStage(3);
    instruction("Tahap 3: Tambahkan lampu");
  }

  if(item==="lamp" && state.battery && !state.lamp){
    const lamp=document.createElement('div');
    lamp.id="lamp";
    lamp.textContent="ðŸ’¡";
    lamp.style.fontSize="40px";
    lamp.style.opacity=".3";
    document.getElementById('board').appendChild(lamp);

    state.lamp=true;
    setStage(4);
    instruction("Tahap 4: Uji material");
  }

  if((item==="metal"||item==="plastic") && state.lamp && !state.tested){
    const lamp=document.getElementById("lamp");
    const wire=document.getElementById("wire");

    if(item==="metal"){
      lamp.style.opacity="1";
      lamp.style.filter="drop-shadow(0 0 15px yellow)";
      wire.classList.add("active");
      addResult("Logam","Konduktor","Lampu menyala");
    } else {
      lamp.style.opacity=".2";
      lamp.style.filter="none";
      wire.classList.remove("active");
      addResult("Plastik","Isolator","Lampu mati");
    }

    document.getElementById('resultBox').classList.remove('d-none');
    instruction("âœ” Pengujian selesai");
    state.tested=true;
  }
});

function setStage(n){ document.getElementById('stage').innerText=n; }
function instruction(t){ document.getElementById('instruction').innerHTML=t; }

function addResult(m,s,h){
  document.getElementById('resultTable').innerHTML=
  `<tr><td>${m}</td><td>${s}</td><td>${h}</td></tr>`;
}

function resetExperiment(){
  state={circuit:false,battery:false,lamp:false,tested:false};
  table.innerHTML='';
  document.getElementById('resultBox').classList.add('d-none');
  setStage(1);
  instruction("Tahap 1: Seret modul rangkaian ke area kerja");
}

function goBack(){
  location.href='beranda-teknik.html';
}
</script>

</body>
</html>
